---
import Sidebar from '../../../components/UI/sidebar.astro';
import Layout from '../../../layouts/baseLayout.astro';

import NyhetCard from '@components/content/NyhetCard.svelte';
import {max_height} from '../../../components/UI/navbar.svelte'
// log om man vill kolla
// posts.map((post) => {
// 	console.log('post här ', post)
// })
// console.log(max_height)
const medlemmar = await Astro.glob('../../../data/medlemmar/*.md')
export async function getStaticPaths({ paginate }) {
	const posts = await Astro.glob('../../../data/nyheter/*.md')
	const publishedPosts = posts.filter(post => !post.frontmatter.draft)
	const sortedPosts = publishedPosts.sort((a, b) => {
		const dateA = new Date(a.frontmatter.date)
		const dateB = new Date(b.frontmatter.date)
		return dateB - dateA
	})
	sortedPosts.map((post)=>console.log(post.frontmatter.date))
    return paginate(sortedPosts, { pageSize: 2 })
}
const { page } = Astro.props
import { format } from 'date-fns'
import { sv } from 'date-fns/locale/index.js'
---
<Layout title="Kodvet är bäst" active={Astro.url.pathname}>
	<div class="wrapper" data-page-json={JSON.stringify(page)} slot="main">
		<script is:inline>
			console.log(JSON.parse(document.querySelector('.wrapper[data-page-json]').dataset.pageJson))
		</script>
		<Sidebar posts={page.data.map(({frontmatter}) => frontmatter)} />
		<section id="inlägg">
			{page.data.map((post, index) => {
				const { Content } = post
				const authors = post.frontmatter.author.map(author => medlemmar.find(medlem => medlem.frontmatter.namn === author))
				const postProps = {
					...post.frontmatter,
					authors: authors.map(author => author.frontmatter)
				}
				console.log("postProps", postProps)
				return (
				<div class="post">
				<div class="scrollAnchor" id={post.frontmatter.title} style={`--max-height: ${max_height}px`}></div>
				<NyhetCard reverse={index % 2} post={postProps}>
					
					<Fragment slot="excerpt">
						{post.frontmatter.excerpt}
					</Fragment>
				</NyhetCard>
				</div>
				)
			}

		)}
		{page.url.prev && <a href={page.url.prev}><button>Förra</button></a>}
		{page.url.next && <a href={page.url.next}><button>Nästa</button></a>}
		</section>	
	</div>

</Layout>

<style>
	.wrapper {
		display: flex;
	}
	/* dessa funkar som "ankare" för att autoscrolla till */
	.scrollAnchor {
		display: block;
		position: relative;
		top: -200px;
		visibility: hidden;
	}
	#inlägg {
		display: flex;
		flex-direction: column;
		margin: 50px;
		gap: 300px;
	}

</style>

